<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../user-message/user-message.html">
<script src="./models/Node.js"></script>

<dom-module id="chat-bot">
  <template>
    <style>
      :host {
        display: block;
      }
      paper-card{
        position: relative;
        height: 500px;
        padding: 10px;
        display: flex;
        flex-direction: column;
        margin: 30px;
      }
      paper-input{
        --paper-input-container-focus-color: var(--paper-green-500);
        position: absolute;
        width: 90%;
        left: 0;
        bottom: 0;
        margin-left: 5%;
        margin-right: 5%;
      }
      paper-button.button{
        background-color: var(--paper-green-500);
        color: white;
        margin-bottom: 2px;
      }
      header{
        background-color: #0288D1;
        color: white;
        padding-left: 30px;
      }
      div#chat{
        display: flex;
        flex-direction: column;
        align-content: flex-end;
        height: 400px;
      }
      user-message{
        padding: 5px;
      }

      div.buttons{
        display: flex;
        justify-content: space-around;
      }
    </style>

    <paper-card>
      <header>
        <h1>I'm a bot</h1>
      </header>
      <div id="chat">
        <dom-repeat items="[[messages]]" as="message">
          <template>
            <user-message id="message" text="[[message.question]]" from="[[message.from]]"></user-message>
          </template>
        </dom-repeat>
      </div>
      <div class="buttons">
        <dom-repeat items="[[buttons]]" as="button">
          <template>
            <paper-button class="button" on-click="">[[button]]</paper-button>
          </template>
        </dom-repeat>
      </div>
    </paper-card>
  </template>

  <script>
    class ChatBot extends Polymer.Element {
    static get is() { return 'chat-bot'; }
    static get properties() {
      return {
        nodes: {
          type: Array,
          value: [],
          computed: '_loadNodes()'
        },
        messages: {
          type: Array,
          value: []
        },
        buttons: {
          type: Array,
          value:[]
        }
      };
    }

    ready(){
      super.ready()
      //inicia todos los nodos
      const bienvenida1 = new Polymer.Node();
      const bienvenida2 = new Polymer.Node();
      const ordenar = new Polymer.Node();
      const confirmOrdenar = new Polymer.Node();
      // set a las propiedades de bienvenida1
      bienvenida1.question = "Hola! Yo soy un bot que te ayudará a ordenar tu comida. Te iré haciando preguntas y con los botones qu ete apareceran abajo, podras elegir la opción deseada. ¿Entendiste?";
      bienvenida1.options.set('yes', ordenar);
      bienvenida1.options.set('no', confirmOrdenar);
      bienvenida1.level = 0;
      bienvenida1.from = 'bot'
      this.nodes.push(bienvenida1);
      // set a las propiedades de ordenar
      ordenar.question = "¿Que deseas ordenar?";
      ordenar.options.set('nada', confirmOrdenar);
      ordenar.level = 1;
      ordenar.from = 'bot'
      this.nodes.push(ordenar);
      // set a las propiedades de confirmOrdenar
      confirmOrdenar.question = "¿En verdad no gutas ordenar nada?";
      confirmOrdenar.options.set('no ordenar', bienvenida1);
      confirmOrdenar.options.set('si ordenar', ordenar);
      confirmOrdenar.level = 1;
      confirmOrdenar.from = 'bot'
      this.nodes.push(confirmOrdenar);

      console.log(this.nodes)
      this.printMessage();
      this.printButtons();

    }

    printMessage(){
      const message = {
        question: this.nodes[0].question,
        from: this.nodes[0].from
      }
      this.messages.push(message)
    }

    printButtons(){
      for(let key of this.nodes[0].options.keys()){
        this.buttons.push(key)
      }
    }

  }

  window.customElements.define(ChatBot.is, ChatBot);
  </script>
</dom-module>
